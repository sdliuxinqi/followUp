<!--pages/doctor/team/team.wxml-->
<view class="page-container">
  
  <!-- å›¢é˜Ÿæˆå‘˜ç®¡ç†æŒ‰é’® -->
  <view class="add-member-button" bindtap="showAddMemberDialog" wx:if="{{isLeader}}">
    <text class="add-button-text">å›¢é˜Ÿæˆå‘˜ç®¡ç†</text>
  </view>

  <!-- å›¢é˜Ÿè´Ÿè´£äºº -->
  <view class="section-header" wx:if="{{leader}}">
    <view class="section-title">å›¢é˜Ÿè´Ÿè´£äºº</view>
  </view>

  <view class="team-list" wx:if="{{leader}}">
    <view class="member-card leader-card">
      <view class="member-header">
        <view class="avatar-wrapper">
          <view class="avatar leader-avatar">{{leader.name ? leader.name.substring(0,1) : '?'}}</view>
          <view class="avatar-badge">ğŸ‘‘</view>
        </view>
        
        <view class="member-info">
          <view class="name-row">
            <text class="name">{{leader.name}}</text>
          </view>
          <view class="role-tag leader-tag">
            <text class="role-icon">â­</text>
            <text>å›¢é˜Ÿè´Ÿè´£äºº</text>
          </view>
        </view>
      </view>
      
      <view class="member-body">
        <view class="info-row">
          <view class="info-item">
            <text class="info-icon">ğŸ¥</text>
            <text class="info-text">{{leader.hospital}}</text>
          </view>
        </view>
        
        <view class="info-row">
          <view class="info-item">
            <text class="info-icon">ğŸ¢</text>
            <text class="info-text">{{leader.department}}</text>
          </view>
        </view>
      </view>
      
      <view class="member-footer">
        <view class="stat-badge leader-stat">
          <text class="stat-icon">ğŸ“Š</text>
          <text class="stat-text">å·²åˆ›å»º {{leader.planCount}} ä¸ªéšè®¿è®¡åˆ’</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å›¢é˜Ÿæˆå‘˜åˆ—è¡¨æ ‡é¢˜ -->
  <view class="section-header" wx:if="{{normalMembers.length > 0}}">
    <view class="section-title">å›¢é˜Ÿæˆå‘˜</view>
    <view class="section-count">{{normalMembers.length}}äºº</view>
  </view>

  <!-- æ™®é€šæˆå‘˜åˆ—è¡¨ -->
  <view class="team-list" wx:if="{{normalMembers.length > 0}}">
    <view class="member-card {{item.isAdmin ? 'admin-card' : ''}}" wx:for="{{normalMembers}}" wx:key="id">
      <!-- æ“ä½œæŒ‰é’®ï¼ˆå³ä¸Šè§’ï¼‰ -->
      <view class="member-actions" wx:if="{{isLeader}}">
        <view class="action-button" bindtap="showMemberActions" data-id="{{item.id}}" data-index="{{index}}">
          <text>â‹®</text>
        </view>
      </view>
      
      <view class="member-header">
        <view class="avatar-wrapper">
          <view class="avatar">{{item.name ? item.name.substring(0,1) : '?'}}</view>
        </view>
        
        <view class="member-info">
          <view class="name-row">
            <text class="name">{{item.name}}</text>
          </view>
          <view class="member-type-tag {{item.isAdmin ? 'admin-tag' : ''}}">
            <text wx:if="{{item.isAdmin}}">ç®¡ç†å‘˜</text>
            <text wx:else>å›¢é˜Ÿæˆå‘˜</text>
          </view>
        </view>
      </view>
      
      <view class="member-body">
        <view class="info-row">
          <view class="info-item">
            <text class="info-icon">ğŸ¥</text>
            <text class="info-text">{{item.hospital}}</text>
          </view>
        </view>
        
        <view class="info-row">
          <view class="info-item">
            <text class="info-icon">ğŸ¢</text>
            <text class="info-text">{{item.department}}</text>
          </view>
        </view>
      </view>
      
      <view class="member-footer">
        <view class="stat-badge">
          <text class="stat-icon">ğŸ“Š</text>
          <text class="stat-text">å·²åˆ›å»º {{item.planCount}} ä¸ªéšè®¿è®¡åˆ’</text>
        </view>
      </view>
    </view>
  </view>
  
  <!-- ç©ºçŠ¶æ€ -->
  <block wx:if="{{teamMembers.length === 0}}">
    <view class="empty-state">
      <view class="empty-icon">ğŸ‘¥</view>
      <text class="empty-text">æš‚æ— å›¢é˜Ÿæˆå‘˜</text>
      <text class="empty-hint">è®¤è¯é€šè¿‡åï¼Œå°†è‡ªåŠ¨æ˜¾ç¤ºåŒä¸€ç§‘å®¤çš„åŒ»ç”Ÿ</text>
      <view class="empty-tips">
        <view class="tip-item">â€¢ ä¸åŒç§‘å®¤åŒ»ç”ŸååŒå·¥ä½œ</view>
        <view class="tip-item">â€¢ å…±äº«éšè®¿è®¡åˆ’å’Œæ•°æ®</view>
        <view class="tip-item">â€¢ æå‡åŒ»ç–—æœåŠ¡æ•ˆç‡</view>
      </view>
    </view>
  </block>
</view>

<!-- æ·»åŠ æˆå‘˜å¼¹çª— - åŒ»ç”Ÿåˆ—è¡¨é€‰æ‹© -->
<view class="modal-mask" wx:if="{{showAddDialog}}" bindtap="hideAddMemberDialog" catchtouchmove="preventMove">
  <view class="modal-container" catchtap="preventClose">
    <view class="modal-header">
      <text class="modal-title">å›¢é˜Ÿæˆå‘˜ç®¡ç†</text>
      <view class="modal-close" bindtap="hideAddMemberDialog">âœ•</view>
    </view>
    
    <view class="modal-body">
      <scroll-view class="doctor-list" scroll-y="{{true}}">
        <view class="doctor-item {{item.isAdded ? 'added disabled' : ''}}" 
          wx:for="{{availableDoctors}}" 
          wx:key="id"
          bindtap="toggleDoctor"
          data-id="{{item.id}}">
          <view class="doctor-avatar">{{item.name ? item.name.substring(0,1) : '?'}}</view>
          <view class="doctor-info">
            <view class="doctor-name">{{item.name}}</view>
            <view class="doctor-detail">
              <text class="doctor-hospital">{{item.hospital}}</text>
              <text class="doctor-separator">Â·</text>
              <text class="doctor-department">{{item.department}}</text>
            </view>
            <view class="doctor-title-tag">{{item.title}}</view>
          </view>
          <view class="doctor-status">
            <text class="status-text" wx:if="{{item.isAdded}}">å·²æ·»åŠ </text>
            <text class="add-icon" wx:else>+</text>
          </view>
        </view>
        
        <view class="empty-doctor" wx:if="{{availableDoctors.length === 0}}">
          <text class="empty-icon">ğŸ‘¨â€âš•ï¸</text>
          <text class="empty-text">æš‚æ— å¯æ·»åŠ çš„åŒ»ç”Ÿ</text>
        </view>
      </scroll-view>
    </view>
  </view>
</view>

<!-- æˆå‘˜æ“ä½œèœå• -->
<view class="action-menu-mask" wx:if="{{showActionMenu}}" bindtap="hideMemberActions">
  <view class="action-menu" catchtap="preventMenuClose">
    <view class="action-menu-item" bindtap="toggleAdmin" data-id="{{currentMemberId}}">
      <text class="action-icon">{{currentMemberIsAdmin ? 'ğŸ”½' : 'â¬†ï¸'}}</text>
      <text class="action-text">{{currentMemberIsAdmin ? 'å–æ¶ˆç®¡ç†å‘˜' : 'è®¾ç½®ä¸ºç®¡ç†å‘˜'}}</text>
    </view>
    <view class="action-menu-item danger" bindtap="confirmRemoveMember" data-id="{{currentMemberId}}">
      <text class="action-icon">ğŸ—‘ï¸</text>
      <text class="action-text">ç§»é™¤æˆå‘˜</text>
    </view>
    <view class="action-menu-item cancel" bindtap="hideMemberActions">
      <text class="action-text">å–æ¶ˆ</text>
    </view>
  </view>
</view>