<!--pages/doctor/plan/patientRecord/patientRecord.wxml-->
<view class="page-container">
  
  <!-- åŸºæœ¬ä¿¡æ¯ï¼ˆå¿…å¡«é¡¹ï¼‰ -->
  <view class="section-header">
    <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
    <view class="section-count">å¿…å¡«é¡¹</view>
  </view>

  <view class="basic-info-card">
    <view class="info-grid">
      <block wx:for="{{record.requiredAnswers}}" wx:key="index">
        <view class="info-grid-item">
          <view class="info-grid-label">{{item.question}}</view>
          <view class="info-grid-value">{{item.answer}}</view>
        </view>
      </block>
    </view>
  </view>

  <!-- è¯¦ç»†éšè®¿å†…å®¹ï¼ˆå¯é€‰é¡¹ï¼‰ -->
  <view class="section-header" wx:if="{{record.optionalAnswers.length > 0}}">
    <view class="section-title">è¯¦ç»†éšè®¿å†…å®¹</view>
    <view class="section-count">{{record.optionalAnswers.length}}ä¸ªé—®é¢˜</view>
  </view>

  <view class="answers-card" wx:if="{{record.optionalAnswers.length > 0}}">
    <view class="answer-item" wx:for="{{record.optionalAnswers}}" wx:key="index">
      <view class="question-number">Q{{index + 1}}</view>
      <view class="question-content">
        <view class="question-text">{{item.question}}</view>
        <view class="answer-text">{{item.answer}}</view>
      </view>
    </view>
  </view>

  <!-- AIåˆ†ææŠ¥å‘Š -->
  <view class="section-header">
    <view class="section-title">AIåˆ†ææŠ¥å‘Š</view>
    <view class="ai-status-badge" wx:if="{{aiAnalyzing}}">åˆ†æä¸­</view>
    <view class="ai-status-badge completed" wx:else>å·²å®Œæˆ</view>
  </view>

  <view class="ai-report-card">
    <block wx:if="{{aiAnalyzing}}">
      <view class="ai-loading">
        <view class="loading-icon">ğŸ¤–</view>
        <view class="loading-text">AIæ­£åœ¨åˆ†ææ‚£è€…æ•°æ®...</view>
        <view class="loading-progress">
          <view class="progress-bar" style="width: {{aiProgress}}%"></view>
        </view>
      </view>
    </block>
    
    <block wx:else>
      <!-- ç»¼åˆè¯„ä¼° -->
      <view class="report-section">
        <view class="report-section-title">ç»¼åˆè¯„ä¼°</view>
        <view class="report-content">{{record.aiReport.summary}}</view>
      </view>

      <!-- è¯¦ç»†åˆ†æ -->
      <view class="report-section">
        <view class="report-section-title">è¯¦ç»†åˆ†æ</view>
        <view class="analysis-item" wx:for="{{record.aiReport.details}}" wx:key="index">
          <view class="analysis-label">{{item.label}}</view>
          <view class="analysis-value">{{item.value}}</view>
        </view>
      </view>

      <!-- åŒ»ç–—å»ºè®® -->
      <view class="report-section">
        <view class="report-section-title">åŒ»ç–—å»ºè®®</view>
        <view class="suggestions-list">
          <view class="suggestion-item" wx:for="{{record.aiReport.suggestions}}" wx:key="index">
            <view class="suggestion-dot"></view>
            <text class="suggestion-text">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="report-actions">
        <view class="action-button primary" bindtap="savePDF" disabled="{{pdfGenerating}}">
          <text class="button-text">{{pdfGenerating ? 'ç”Ÿæˆä¸­...' : 'ä¿å­˜ä¸ºPDF'}}</text>
        </view>
        <view class="action-button" bindtap="sharePDF" disabled="{{pdfGenerating}}">
          <text class="button-text">åˆ†äº«æŠ¥å‘Š</text>
        </view>
      </view>
    </block>
  </view>
</view>
