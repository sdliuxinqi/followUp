<!--pages/patient/home/home.wxml-->
<!-- 自定义导航栏 -->
<view class="nav-bar" style="padding-top: {{statusBarHeight}}px;">
  <view class="nav-content">
    <view class="nav-left" bindtap="backToIndex">
      <image class="back-icon" src="/assets/images/home.png" mode="aspectFit" />
    </view>
    <view class="nav-title">随访小助手</view>
    <view class="nav-right"></view>
  </view>
</view>

<view class="page-container" style="padding-top: {{statusBarHeight + navBarHeight}}px;">
  <!-- 快速操作区域 -->
  <view class="quick-actions">
    <view class="action-card scan-card" bindtap="scanQRCode">
      <view class="action-icon-wrapper">
        <text class="action-icon qr-icon">⊞</text>
      </view>
      <view class="action-content">
        <view class="action-title">扫码随访</view>
        <view class="action-desc">扫描医生二维码填写随访</view>
      </view>
      <view class="action-arrow">›</view>
    </view>
  </view>

    <!-- 我的随访列表 -->
    <view class="records-section">
      <view class="section-header">
        <text class="section-title">我的随访计划</text>
        <text class="record-count">共{{followRecords.length}}条</text>
      </view>
      
      <!-- 日常自我评估（单独显示） -->
      <block wx:if="{{dailyAssessmentRecords.length > 0}}">
        <view class="group-header daily-group">
          <text class="group-title">日常自我评估</text>
        </view>
        <view class="follow-list">
          <view class="follow-item daily-follow" wx:for="{{dailyAssessmentRecords}}" wx:key="id" bindtap="viewFollowDetail" data-id="{{item.id}}" data-status="{{item.status}}" data-plan-id="{{item.planId || item.id}}" data-time-type="{{item.timeType}}">
            <view class="follow-info">
              <view class="follow-title-row">
                <view class="follow-title-wrapper">
                  <text class="daily-icon">📅</text>
                  <view class="follow-title">{{item.planTitle}}</view>
                </view>
              </view>
              <view class="follow-meta">
                <text class="doctor-name">👨‍⚕️ {{item.doctorName}}</text>
              </view>
              <view class="follow-time">
                <text wx:if="{{item.fillTime}}">🕐 最近填写：{{item.fillTime}}</text>
                <text wx:else>⏰ 待填写</text>
              </view>
            </view>
            <view class="arrow-icon">›</view>
          </view>
        </view>
      </block>
      
      <!-- 待完成的随访 -->
      <block wx:if="{{pendingRecords.length > 0}}">
      <view class="group-header">
        <text class="group-title">待办事项</text>
        <text class="group-count">{{pendingRecords.length}}条</text>
      </view>
      <view class="follow-list">
        <view class="follow-item {{item.status === 'pending' ? 'status-pending' : item.status === 'completed' ? 'status-completed' : 'status-expired'}}" wx:for="{{pendingRecords}}" wx:key="id" bindtap="viewFollowDetail" data-id="{{item.id}}" data-status="{{item.status}}" data-plan-id="{{item.planId || item.id}}" data-time-type="{{item.timeType}}">
          <view class="follow-info">
            <view class="follow-title-row">
              <view class="follow-title-wrapper">
                <view class="follow-title">{{item.planTitle}}</view>
              </view>
              <view class="status-badge status-{{item.status}}">
                <text wx:if="{{item.status === 'pending'}}">待完成</text>
                <text wx:elif="{{item.status === 'completed'}}">已完成</text>
                <text wx:else>已失效</text>
              </view>
            </view>
            <view class="follow-meta">
              <text class="doctor-name">👨‍⚕️ {{item.doctorName}}</text>
            </view>
            <view class="follow-time">
              <text wx:if="{{item.status === 'completed'}}">🕐 {{item.fillTime}}</text>
              <text wx:else>⏰ 推荐日期：{{item.fillTime}}</text>
            </view>
          </view>
          <view class="arrow-icon">›</view>
        </view>
      </view>
    </block>
    
    <!-- 已完成/已失效的随访 -->
    <block wx:if="{{otherRecords.length > 0}}">
      <view class="group-header other-group">
        <text class="group-title">历史记录</text>
        <text class="group-count">{{otherRecords.length}}条</text>
      </view>
      <view class="follow-list">
        <view class="follow-item {{item.status === 'pending' ? 'status-pending' : item.status === 'completed' ? 'status-completed' : 'status-expired'}}" wx:for="{{otherRecords}}" wx:key="id" bindtap="viewFollowDetail" data-id="{{item.id}}" data-status="{{item.status}}" data-plan-id="{{item.planId || item.id}}" data-time-type="{{item.timeType}}">
          <view class="follow-info">
            <view class="follow-title-row">
              <view class="follow-title-wrapper">
                <view class="follow-title">{{item.planTitle}}</view>
              </view>
              <view class="status-badge status-{{item.status}}">
                <text wx:if="{{item.status === 'pending'}}">待完成</text>
                <text wx:elif="{{item.status === 'completed'}}">已完成</text>
                <text wx:else>已失效</text>
              </view>
            </view>
            <view class="follow-meta">
              <text class="doctor-name">👨‍⚕️ {{item.doctorName}}</text>
            </view>
            <view class="follow-time">
              <text wx:if="{{item.status === 'completed'}}">🕐 {{item.fillTime}}</text>
              <text wx:elif="{{item.status === 'expired'}}">⏰ 推荐日期：{{item.fillTime}}</text>
              <text wx:else>⏰ 推荐日期：{{item.fillTime}}</text>
            </view>
          </view>
          <view class="arrow-icon">›</view>
        </view>
      </view>
    </block>
    
    <!-- 空状态 -->
    <block wx:if="{{followRecords.length === 0}}">
      <view class="empty-state">
        <text class="empty-icon">📋</text>
        <text class="empty-text">暂无随访记录</text>
        <text class="empty-hint">请点击上方"扫码随访"参与医生的随访计划</text>
      </view>
    </block>
  </view>
</view>