<!--pages/patient/register/register.wxml-->
<view class="page-container">
  <!-- è¡¨å•å¡ç‰‡ -->
  <view class="form-card">
    <view class="form-title">æ‚£è€…åŸºæœ¬ä¿¡æ¯</view>
    
    <form bindsubmit="submitRegister">
      <!-- å§“å -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">å§“å</text>
          <text class="required">*</text>
        </view>
        <input class="input" name="name" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" value="{{formData.name}}" />
      </view>

      <!-- å‡ºç”Ÿæ—¥æœŸå’Œæ€§åˆ« -->
      <view class="form-row">
        <view class="form-item half-item">
          <view class="label-row">
            <text class="label">å‡ºç”Ÿæ—¥æœŸ</text>
            <text class="required">*</text>
          </view>
          <picker 
            mode="date" 
            value="{{formData.birthDate}}" 
            start="1900-01-01"
            end="{{currentDate}}"
            bindchange="onDateChange"
          >
            <view class="date-selector">
              <text class="date-text {{formData.birthDate ? '' : 'placeholder'}}">
                {{formData.birthDate || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'}}
              </text>
            </view>
          </picker>
        </view>

        <view class="form-item half-item">
          <view class="label-row">
            <text class="label">æ€§åˆ«</text>
            <text class="required">*</text>
          </view>
          <view class="gender-selector">
            <view class="gender-btn {{formData.gender === 'ç”·' ? 'active' : ''}}" bindtap="selectGender" data-gender="ç”·">
              <text class="gender-text">ç”·</text>
            </view>
            <view class="gender-btn {{formData.gender === 'å¥³' ? 'active' : ''}}" bindtap="selectGender" data-gender="å¥³">
              <text class="gender-text">å¥³</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ä½é™¢å· -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">ä½é™¢å·</text>
          <text class="required">*</text>
        </view>
        <input class="input" name="admissionNumber" placeholder="è¯·è¾“å…¥ä½é™¢å·" value="{{formData.admissionNumber}}" />
      </view>

      <!-- æ‰‹æœºå· -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">æ‰‹æœºå·</text>
          <text class="required">*</text>
        </view>
        <view class="phone-input-wrapper">
          <input class="input phone-input" name="phone" type="number" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="{{formData.phone}}" />
          <button class="auth-button" open-type="getPhoneNumber" bindgetphonenumber="getPhoneNumber">
            ä¸€é”®è·å–
          </button>
        </view>
      </view>

      <!-- æ²»ç–—ç»„ -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">æ²»ç–—ç»„</text>
        </view>
        <view class="team-selector" bindtap="showDoctorList">
          <text class="team-value {{formData.teamName ? '' : 'placeholder'}}">
            {{formData.teamName || 'è¯·é€‰æ‹©æ²»ç–—ç»„'}}
          </text>
          <text class="selector-arrow">â€º</text>
        </view>
        <view class="team-hint">ç‚¹å‡»é€‰æ‹©æ‚¨çš„æ²»ç–—ç»„</view>
      </view>

      <!-- æäº¤æŒ‰é’® -->
      <button class="submit-btn" form-type="submit" loading="{{loading}}">
        {{loading ? 'æäº¤ä¸­...' : 'æäº¤ç™»è®°'}}
      </button>
    </form>

    <!-- åº•éƒ¨æç¤º -->
    <view class="footer-note">
      <text class="note-text">æ³¨ï¼šæäº¤åè¯·ç­‰å¾…æ²»ç–—ç»„ç¡®è®¤</text>
    </view>
  </view>

  <!-- åŒ»ç”Ÿåˆ—è¡¨å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showDoctorModal}}" bindtap="hideDoctorList">
    <view class="modal-container" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©æ²»ç–—ç»„</text>
        <text class="modal-close" bindtap="hideDoctorList">âœ•</text>
      </view>
      <view class="modal-body">
        <scroll-view class="doctor-list" scroll-y>
          <view 
            class="doctor-item {{formData.doctorId === doctor.id ? 'selected' : ''}}" 
            wx:for="{{doctorList}}" 
            wx:key="id"
            bindtap="selectDoctor"
            data-doctor="{{item}}">
            <view class="doctor-info">
              <view class="doctor-avatar">
                <text class="avatar-icon">ğŸ‘¨â€âš•ï¸</text>
              </view>
              <view class="doctor-details">
                <view class="doctor-name">{{item.teamDisplayName}}</view>
                <view class="doctor-meta">
                  <text class="doctor-title">{{item.title}}</text>
                  <text class="doctor-dept">{{item.department}}</text>
                </view>
                <view class="doctor-hospital">{{item.hospital}}</view>
              </view>
            </view>
            <view class="check-icon" wx:if="{{formData.doctorId === item.id}}">âœ“</view>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>
</view>

