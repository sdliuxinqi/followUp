<!--pages/patient/record/detail/detail.wxml-->
<view class="page-container">
  <!-- éšè®¿è®¡åˆ’ä¿¡æ¯å¡ç‰‡ -->
  <view class="plan-info-card">
    <view class="plan-header">
      <view class="plan-title">{{followRecord.planTitle}}</view>
    </view>
    <view class="plan-meta">
      <view class="meta-item">
        <text class="meta-label">è´Ÿè´£åŒ»ç”Ÿ</text>
        <text class="meta-value">{{followRecord.doctorName}}</text>
      </view>
      <view class="meta-item">
        <text class="meta-label">å¡«å†™æ—¶é—´</text>
        <text class="meta-value">{{followRecord.fillTime}}</text>
      </view>
    </view>
  </view>

  <!-- åŸºæœ¬ä¿¡æ¯ -->
  <view class="section-card" wx:if="{{followRecord.basicAnswers && followRecord.basicAnswers.length > 0}}">
    <view class="section-header">
      <text class="section-title">åŸºæœ¬ä¿¡æ¯</text>
    </view>
    <view class="basic-info-grid">
      <view class="basic-info-item" wx:for="{{followRecord.basicAnswers}}" wx:key="index">
        <view class="basic-info-label">{{item.question}}</view>
        <view class="basic-info-value">{{item.answer}}</view>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½è¯„ä¼°ï¼ˆæŒ‰é‡è¡¨åˆ†ç»„ï¼‰ -->
  <view class="section-card" wx:if="{{followRecord.functionalAssessments && followRecord.functionalAssessments.length > 0}}">
    <view class="section-header">
      <text class="section-title">åŠŸèƒ½è¯„ä¼°</text>
      <text class="section-count">{{followRecord.functionalAssessments.length}}ä¸ªé‡è¡¨</text>
    </view>
    <view class="functional-assessments">
      <view class="assessment-card" wx:for="{{followRecord.functionalAssessments}}" wx:key="id">
        <view class="assessment-header">
          <view class="assessment-icon">ğŸ“Š</view>
          <view class="assessment-info">
            <view class="assessment-title-row">
              <view class="assessment-title">{{item.title}}</view>
              <view class="assessment-score" wx:if="{{item.totalScore !== undefined}}">
                <text class="score-label">æ€»åˆ†</text>
                <text class="score-value">{{item.totalScore}}åˆ†</text>
              </view>
            </view>
            <view class="assessment-description" wx:if="{{item.description}}">{{item.description}}</view>
          </view>
        </view>
        
        <view class="assessment-questions">
          <view class="assessment-question-item" wx:for="{{item.questions}}" wx:key="index" wx:for-item="qItem">
            <view class="question-label">{{qItem.question}}</view>
            <view class="question-answer-row">
              <view class="question-answer">{{qItem.answer}}</view>
              <view class="question-score" wx:if="{{qItem.score !== undefined}}">{{qItem.score}}åˆ†</view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- AIåˆ†ææŠ¥å‘Š -->
  <view class="section-card" wx:if="{{followRecord.aiReport}}">
    <view class="section-header">
      <text class="section-title">AIæ™ºèƒ½åˆ†æ</text>
    </view>
    <view class="ai-report-card">
      <view class="report-icon">ğŸ¤–</view>
      <view class="report-summary">{{followRecord.aiReportSummary}}</view>
      <view class="report-details">
        <view class="detail-item" wx:for="{{followRecord.aiReportDetails}}" wx:key="index">
          <text class="detail-label">{{item.label}}ï¼š</text>
          <text class="detail-value">{{item.value}}</text>
        </view>
      </view>
      <button class="download-btn" bindtap="downloadReport">
        <text class="btn-icon">ğŸ“„</text>
        <text>ä¸‹è½½å®Œæ•´æŠ¥å‘Š</text>
      </button>
    </view>
  </view>
</view>