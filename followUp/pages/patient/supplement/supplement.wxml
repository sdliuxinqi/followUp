<!--pages/patient/supplement/supplement.wxml-->
<view class="page-container">
  <!-- è¡¨å•å¡ç‰‡ -->
  <view class="form-card">
    <view class="form-title">è¡¥å……æ‚£è€…ä¿¡æ¯</view>
    <view class="form-hint">è¯·è¡¥å……ä»¥ä¸‹ä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°ä¸ºæ‚¨æä¾›éšè®¿æœåŠ¡</view>
    
    <form bindsubmit="submitSupplement">
      <!-- ä½é™¢å· -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">ä½é™¢å·</text>
          <text class="required">*</text>
        </view>
        <input class="input" name="admissionNumber" placeholder="è¯·è¾“å…¥ä½é™¢å·" value="{{formData.admissionNumber}}" />
      </view>

      <!-- æ²»ç–—ç»„ -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">æ²»ç–—ç»„</text>
          <text class="required">*</text>
        </view>
        <view class="team-selector" bindtap="showDoctorList">
          <text class="team-value {{formData.teamName ? '' : 'placeholder'}}">
            {{formData.teamName || 'è¯·é€‰æ‹©æ²»ç–—ç»„'}}
          </text>
          <text class="selector-arrow">â€º</text>
        </view>
        <view class="team-hint">ç‚¹å‡»é€‰æ‹©æ‚¨çš„æ²»ç–—ç»„</view>
      </view>

      <!-- ä½é™¢æ—¶é—´ -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">ä½é™¢æ—¶é—´</text>
        </view>
        <picker 
          mode="date" 
          value="{{formData.admissionDate}}" 
          start="1900-01-01"
          end="{{currentDate}}"
          bindchange="onDateChange"
          data-field="admissionDate"
        >
          <view class="date-selector">
            <text class="date-text {{formData.admissionDate ? '' : 'placeholder'}}">
              {{formData.admissionDate || 'è¯·é€‰æ‹©ä½é™¢æ—¶é—´'}}
            </text>
          </view>
        </picker>
      </view>

      <!-- æ‰‹æœ¯æ—¶é—´ -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">æ‰‹æœ¯æ—¶é—´</text>
        </view>
        <picker 
          mode="date" 
          value="{{formData.surgeryDate}}" 
          start="1900-01-01"
          end="{{currentDate}}"
          bindchange="onDateChange"
          data-field="surgeryDate"
        >
          <view class="date-selector">
            <text class="date-text {{formData.surgeryDate ? '' : 'placeholder'}}">
              {{formData.surgeryDate || 'è¯·é€‰æ‹©æ‰‹æœ¯æ—¶é—´'}}
            </text>
          </view>
        </picker>
      </view>

      <!-- å‡ºé™¢æ—¶é—´ -->
      <view class="form-item">
        <view class="label-row">
          <text class="label">å‡ºé™¢æ—¶é—´</text>
        </view>
        <picker 
          mode="date" 
          value="{{formData.dischargeDate}}" 
          start="1900-01-01"
          end="{{currentDate}}"
          bindchange="onDateChange"
          data-field="dischargeDate"
        >
          <view class="date-selector">
            <text class="date-text {{formData.dischargeDate ? '' : 'placeholder'}}">
              {{formData.dischargeDate || 'è¯·é€‰æ‹©å‡ºé™¢æ—¶é—´'}}
            </text>
          </view>
        </picker>
      </view>

      <!-- æäº¤æŒ‰é’® -->
      <button class="submit-btn" form-type="submit" loading="{{loading}}">
        {{loading ? 'æäº¤ä¸­...' : 'æäº¤'}}
      </button>
    </form>
  </view>

  <!-- åŒ»ç”Ÿåˆ—è¡¨å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showDoctorModal}}" bindtap="hideDoctorList">
    <view class="modal-container" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©æ²»ç–—ç»„</text>
        <text class="modal-close" bindtap="hideDoctorList">âœ•</text>
      </view>
      <view class="modal-body">
        <scroll-view class="doctor-list" scroll-y>
          <view 
            class="doctor-item {{formData.doctorId === doctor.id ? 'selected' : ''}}" 
            wx:for="{{doctorList}}" 
            wx:key="id"
            bindtap="selectDoctor"
            data-doctor="{{item}}">
            <view class="doctor-info">
              <view class="doctor-avatar">
                <text class="avatar-icon">ğŸ‘¨â€âš•ï¸</text>
              </view>
              <view class="doctor-details">
                <view class="doctor-name">{{item.teamDisplayName}}</view>
                <view class="doctor-meta">
                  <text class="doctor-title">{{item.title}}</text>
                  <text class="doctor-dept">{{item.department}}</text>
                </view>
                <view class="doctor-hospital">{{item.hospital}}</view>
              </view>
            </view>
            <view class="check-icon" wx:if="{{formData.doctorId === item.id}}">âœ“</view>
          </view>
        </scroll-view>
      </view>
    </view>
  </view>
</view>

