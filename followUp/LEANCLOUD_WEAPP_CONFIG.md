# LeanCloud 微信小程序配置指南

## 问题描述

如果遇到以下错误：
```
微信登录失败: Error: Please set the appid and the secret of weapp at LeanCloud console.
```

这说明需要在 LeanCloud 控制台配置微信小程序的 AppID 和 AppSecret。

## 配置步骤

### 第一步：获取微信小程序 AppID 和 AppSecret

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入你的小程序后台
3. 点击左侧菜单 **开发** → **开发管理** → **开发设置**
4. 在 **开发者 ID** 部分：
   - **AppID (小程序ID)**: `wx1699aff3054e007b`（已配置在项目中）
   - **AppSecret (小程序密钥)**: 点击 **生成** 或 **重置** 获取
     - 如果已生成，点击 **查看** 按钮
     - 如果没有，点击 **生成** 按钮
     - ⚠️ **注意**: AppSecret 只在显示时可见一次，请妥善保存

### 第二步：在 LeanCloud 控制台配置

1. **登录 LeanCloud 控制台**
   - 访问：https://console.leancloud.cn/
   - 使用你的账号登录

2. **选择应用**
   - 找到并点击应用：`qFY2EfADtBfkzbT7SvDql1Ba-gzGzoHsz`

3. **进入社交登录设置**
   - 点击左侧菜单 **设置** → **社交登录**（或 **应用设置** → **社交登录**）
   - 如果找不到，可能在不同版本的控制台中位置略有不同，尝试：
     - **设置** → **应用凭证** → **社交登录**
     - **应用设置** → **应用凭证** → **社交登录**

4. **配置微信小程序**
   - 找到 **微信小程序** 部分
   - 填写以下信息：
     - **微信小程序 AppID**: `wx1699aff3054e007b`
     - **微信小程序 AppSecret**: （从微信公众平台获取的密钥）
   - 点击 **保存** 按钮

### 第三步：验证配置

1. 配置完成后，等待 1-2 分钟让配置生效
2. 重新启动小程序
3. 尝试登录，应该可以正常工作了

## 找不到配置选项？

如果在 LeanCloud 控制台中找不到微信小程序设置：

### 方法一：检查控制台版本
- 确保使用的是最新版本的 LeanCloud 控制台
- 尝试刷新页面或清除浏览器缓存

### 方法二：检查权限
- 确保你的账户有 **管理员** 或 **开发** 权限
- 只有管理员可以修改应用设置

### 方法三：联系支持
- 如果仍然找不到，联系 LeanCloud 技术支持
- 或在 LeanCloud 社区提问

## 额外配置（上线前必做）

### 在微信公众平台配置服务器域名

小程序上线前，需要在微信公众平台配置服务器域名：

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入小程序后台
3. 点击 **开发** → **开发管理** → **开发设置**
4. 找到 **服务器域名** 部分
5. 在 **request 合法域名** 中添加：
   ```
   https://server.tka-followup.top
   ```
6. 点击 **保存并提交**

### 开发环境测试

开发环境可以在微信开发者工具中：
1. 打开 **设置** → **项目设置**
2. 勾选 **不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书**
3. 这样可以在开发时测试，但上线前必须配置正确的域名

## 常见问题

### Q: AppSecret 忘记了怎么办？
A: 在微信公众平台重新生成新的 AppSecret，然后在 LeanCloud 控制台更新即可。

### Q: 配置后仍然报错？
A: 
1. 检查 AppID 和 AppSecret 是否完全正确（注意大小写和空格）
2. 等待 1-2 分钟让配置生效
3. 重新启动小程序
4. 检查网络连接

### Q: 是否需要重启 LeanCloud 云引擎？
A: 不需要。这是控制台的配置，配置后会自动生效。

## 相关链接

- [LeanCloud 控制台](https://console.leancloud.cn/)
- [微信公众平台](https://mp.weixin.qq.com/)
- [LeanCloud 文档 - 微信小程序登录](https://leancloud.cn/docs/weapp.html)

